name: Changelog Generator

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  generate_changelog_file:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        token: ${{ secrets.GH_TOKEN }}

    - name: Generate changelog
      uses: heinrichreimer/github-changelog-generator-action@v2.2
      with:
        token: ${{ secrets.GH_TOKEN }}
        author: true
        unreleased: true
        unreleasedLabel: "ğŸš§Unreleased"
        issues: true
        pullRequests: true
        prWoLabels: false
        compareLink: true
        output: CHANGELOG.md
        breakingLabel: "### ğŸ’¥ Breaking Changes:"
        breakingLabels: "breaking"
        deprecatedLabel: "### ğŸ‘‹ Depricated"
        deprecatedLabels: "deprecation"
        enhancementLabel: "### âœ¨ Features and Enhancements:"
        enhancementLabels: "enhancement"
        bugsLabel: "### ğŸ› Bug Fixes:"
        bugLabels: "bug,bug-fix,fix,fixes"
        removedLabel: '### ğŸ—‘ï¸ Removals:'
        removedLabels: 'removal'
        addSections: >-
                {
                        "documentation": {
                                "prefix":"### ğŸ“– Documentation updates",
                                "labels":["documentation"]
                        },
                        "style": {
                                "prefix":"### ğŸ’„ Style",
                                "labels":["style"]
                        },
                        "dependencies": {
                                "prefix":"### ğŸ“¦ Dependencies",
                                "labels":["dependencies"]
                        },
                        "refactoring": {
                                "prefix":"### ğŸ”¨ Refactoring",
                                "labels":["refactoring"]
                        },
                        "ci":{
                                "prefix":"### ğŸ‘· Build and CI",
                                "labels":["ci", "build"]
                        },
                        "configs":{
                                "prefix":"### âš™ï¸  Model and sweep configs",
                                "labels":["configs", "config"]
                        },
                        "utils":{
                                "prefix":"### ğŸ§ª Peripheral utilities",
                                "labels":["utils", "utilities"]
                        }
                }
        # See: emojipedia.org for emoji codes
    - name: Commit CHANGELOG.md
      uses: EndBug/add-and-commit@v7 # You can change this to use a specific version
      if: success()
      with:
        add: 'CHANGELOG.md'
